name: Jasstafel Linux CI
on: [push]

# cspell:disable
jobs:
  test-linux:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Check out submodule
        run: git submodule update --init --force
      - run: |
          sudo apt-get update -y
          sudo apt-get install -y ninja-build libgtk-3-dev
          export DISPLAY=:99
          sudo Xvfb -ac :99 -screen 0 1280x1024x24 > /dev/null 2>&1 &
          flutter/bin/flutter config --enable-linux-desktop
      - name: Get dependencies
        run: flutter/bin/flutter pub get
      - name: Generate icons
        run: flutter/bin/flutter pub run flutter_launcher_icons
      - name: Generate translations
        run: flutter/bin/flutter gen-l10n
      - name: Generate sources
        run: flutter/bin/flutter packages pub run build_runner build --delete-conflicting-outputs
      - name: Test
        run: flutter/bin/flutter test
      - name: Integration test
        run: flutter/bin/flutter test integration_test -d linux
